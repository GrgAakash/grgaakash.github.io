<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIHRS Model Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #45a049; }
        #output { background: #2a2a2a; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; }
        canvas { background: white; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>SIHRS Model Test</h1>
    
    <div class="test-section">
        <h3>Test Parameters</h3>
        <button onclick="testModel()">Test SIHRS Model</button>
        <button onclick="clearOutput()">Clear Output</button>
        <div id="output"></div>
    </div>
    
    <div class="test-section">
        <h3>Chart Test</h3>
        <canvas id="testChart" width="800" height="400"></canvas>
    </div>

    <script src="src/js/models/sihrs-model.js"></script>
    <script>
        let outputDiv = document.getElementById('output');
        
        function log(message) {
            outputDiv.innerHTML += message + '<br>';
            console.log(message);
        }
        
        function clearOutput() {
            outputDiv.innerHTML = '';
        }
        
        function testModel() {
            clearOutput();
            log('=== SIHRS Model Test ===');
            
            // Test parameters
            const testParams = {
                beta: 0.160,
                gamma: 0.126,
                alpha: 0.100,
                lambda: 0.007,
                pSI: 1.000,
                pII: 0.000,
                pIH: 0.040,
                pIR: 0.959,
                pID: 0.001,
                pHH: 0.010,
                pHR: 0.988,
                pHD: 0.002,
                pRR: 0.020,
                pRS: 0.980,
                tmax: 50,
                s0: 0.999,
                i0: 0.001,
                h0: 0.000,
                r0: 0.000,
                d0: 0.000
            };
            
            log('Parameters: ' + JSON.stringify(testParams, null, 2));
            
            try {
                // Test validation
                log('Testing parameter validation...');
                validateSIHRSParameters(testParams);
                log('✓ Parameter validation passed');
                
                // Test R₀ calculation
                log('Testing R₀ calculation...');
                const R0 = calculateR0SIHRS(testParams);
                log(`✓ R₀ = ${R0.toFixed(3)}`);
                
                // Test thresholds
                log('Testing threshold calculation...');
                const [R0_thresh, sigma, sigma1, sigma2] = calculateSIHRSThresholds(testParams);
                log(`✓ Thresholds: R₀=${R0_thresh.toFixed(3)}, σ=${sigma.toFixed(3)}, σ̃=${sigma1.toFixed(3)}, σ̃̃=${sigma2.toFixed(3)}`);
                
                // Test stochastic simulation
                log('Testing stochastic simulation...');
                const N = 1000;
                const result = sihrsStochasticModel(N, testParams, 1);
                log(`✓ Stochastic simulation complete: ${result.T.length} time points`);
                log(`  Max I: ${(result.maxI * 100).toFixed(2)}%`);
                log(`  Max H: ${(result.maxH * 100).toFixed(2)}%`);
                log(`  Final D: ${(result.finalD * 100).toFixed(3)}%`);
                log(`  Reinfections: ${result.reinfectionCount}`);
                
                // Test deterministic simulation
                log('Testing deterministic simulation...');
                const detResult = solveDeterministicSIHRS(testParams);
                log(`✓ Deterministic simulation complete: ${detResult.T.length} time points`);
                log(`  Max I: ${(Math.max(...detResult.I_prop) * 100).toFixed(2)}%`);
                log(`  Max H: ${(Math.max(...detResult.H_prop) * 100).toFixed(2)}%`);
                log(`  Final D: ${(detResult.D_prop[detResult.D_prop.length - 1] * 100).toFixed(3)}%`);
                
                // Create test chart
                createTestChart(result, detResult);
                
            } catch (error) {
                log('✗ Error: ' + error.message);
                console.error(error);
            }
        }
        
        function createTestChart(stochResult, detResult) {
            const ctx = document.getElementById('testChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Stochastic I',
                            data: stochResult.T.map((t, i) => ({ x: t, y: stochResult.I_prop[i] })),
                            borderColor: 'rgba(49, 130, 206, 0.8)',
                            backgroundColor: 'rgba(49, 130, 206, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Deterministic I',
                            data: detResult.T.map((t, i) => ({ x: t, y: detResult.I_prop[i] })),
                            borderColor: 'rgba(255, 99, 132, 0.8)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 3,
                            borderDash: [8, 4],
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'SIHRS Test - Stochastic vs Deterministic',
                            color: '#ffffff'
                        },
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Time (days)', color: '#ffffff' },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Proportion', color: '#ffffff' },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // Auto-run test on page load
        window.addEventListener('load', function() {
            setTimeout(testModel, 1000);
        });
    </script>
</body>
</html> 